<!DOCTYPE html>
<html>
<head>
  <title>Debug Photos - Fremio</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    .box { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    h1 { color: #333; }
    .success { background: #d4edda; color: #155724; padding: 10px; border-radius: 4px; margin: 10px 0; }
    .error { background: #f8d7da; color: #721c24; padding: 10px; border-radius: 4px; margin: 10px 0; }
    .warning { background: #fff3cd; color: #856404; padding: 10px; border-radius: 4px; margin: 10px 0; }
    button { padding: 10px 20px; margin: 5px; background: #e0b7a9; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #c89585; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 11px; max-height: 300px; overflow-y: auto; }
    .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 10px; }
    .photo-grid img { width: 100%; height: 150px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd; }
  </style>
</head>
<body>
  <h1>üîç Debug Photos in LocalStorage</h1>
  
  <div class="box">
    <h2>Actions</h2>
    <button onclick="checkPhotos()">üîç Check Photos</button>
    <button onclick="checkAllStorage()">üì¶ Check All Storage</button>
    <button onclick="location.reload()">üîÑ Refresh</button>
  </div>

  <div class="box">
    <h2>Status</h2>
    <div id="status"></div>
  </div>

  <div class="box" id="photosBox" style="display:none;">
    <h2>Photos Preview</h2>
    <div id="photosPreview" class="photo-grid"></div>
  </div>

  <div class="box">
    <h2>Raw Data</h2>
    <pre id="rawData"></pre>
  </div>

  <script>
    function checkPhotos() {
      const status = document.getElementById('status');
      const photosBox = document.getElementById('photosBox');
      const photosPreview = document.getElementById('photosPreview');
      const rawData = document.getElementById('rawData');
      
      try {
        // Check raw localStorage
        const raw = localStorage.getItem('capturedPhotos');
        
        if (!raw) {
          status.innerHTML = '<div class="error">‚ùå capturedPhotos NOT FOUND in localStorage</div>';
          photosBox.style.display = 'none';
          rawData.textContent = 'No data';
          return;
        }
        
        // Parse
        const photos = JSON.parse(raw);
        
        if (!Array.isArray(photos)) {
          status.innerHTML = '<div class="error">‚ùå capturedPhotos is not an array</div>';
          rawData.textContent = 'Type: ' + typeof photos + '\n' + raw.substring(0, 500);
          return;
        }
        
        if (photos.length === 0) {
          status.innerHTML = '<div class="warning">‚ö†Ô∏è capturedPhotos is empty array []</div>';
          photosBox.style.display = 'none';
          return;
        }
        
        // Success!
        status.innerHTML = `<div class="success">‚úÖ Found ${photos.length} photos in localStorage!</div>`;
        
        // Show previews
        photosBox.style.display = 'block';
        photosPreview.innerHTML = '';
        
        photos.forEach((photo, idx) => {
          if (photo && typeof photo === 'string' && photo.startsWith('data:')) {
            const img = document.createElement('img');
            img.src = photo;
            img.alt = `Photo ${idx + 1}`;
            img.title = `Photo ${idx + 1} (${(photo.length / 1024).toFixed(1)} KB)`;
            photosPreview.appendChild(img);
          } else {
            const div = document.createElement('div');
            div.style.cssText = 'width:100%;height:150px;background:#f0f0f0;display:flex;align-items:center;justify-content:center;border-radius:4px;';
            div.textContent = `Invalid photo ${idx + 1}`;
            photosPreview.appendChild(div);
          }
        });
        
        // Show raw data summary
        rawData.textContent = `Total photos: ${photos.length}\n` +
          `Total size: ${(raw.length / 1024).toFixed(1)} KB\n\n` +
          photos.map((p, i) => `Photo ${i + 1}: ${p ? (p.length / 1024).toFixed(1) + ' KB' : 'null'}`).join('\n');
        
      } catch (error) {
        status.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
        rawData.textContent = error.stack;
      }
    }
    
    function checkAllStorage() {
      const rawData = document.getElementById('rawData');
      const status = document.getElementById('status');
      
      const keys = ['capturedPhotos', 'capturedVideos', 'frameConfig', 'selectedFrame', 'custom_frames'];
      let output = '=== LocalStorage Contents ===\n\n';
      
      keys.forEach(key => {
        const val = localStorage.getItem(key);
        if (val) {
          output += `üì¶ ${key}:\n`;
          output += `   Size: ${(val.length / 1024).toFixed(1)} KB\n`;
          
          try {
            const parsed = JSON.parse(val);
            if (Array.isArray(parsed)) {
              output += `   Type: Array (${parsed.length} items)\n`;
            } else if (typeof parsed === 'object') {
              output += `   Type: Object\n`;
              output += `   Keys: ${Object.keys(parsed).slice(0, 10).join(', ')}\n`;
            }
          } catch (e) {
            output += `   Type: String\n`;
          }
          output += '\n';
        } else {
          output += `‚ùå ${key}: NOT FOUND\n\n`;
        }
      });
      
      rawData.textContent = output;
      status.innerHTML = '<div class="success">‚úÖ Storage check complete - see Raw Data below</div>';
    }
    
    // Auto-check on load
    window.onload = checkPhotos;
  </script>
</body>
</html>
